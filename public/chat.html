<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tyk√°ƒç ‚Äì chat</title>
<meta name="description" content="Gen-Z chat (Tyk√°ƒç). Kr√°tk√©, trefn√©, trochu drz√© odpovƒõdi.">
<style>
  :root{
    /* New design system colors */
    --bg-0:#0A0A0A;
    --bg-1:#080808;
    --bg-2:#0E0E0E;
    --text:#F4F4F4;
    --muted:#BDBDBD;

    --lime:#B8FF4D;
    --cyan:#27F1E2;
    --pink:#FF5FA6;

    --card:#121212;
    --radius:18px;
    --gap:22px;
    
    /* Legacy compat */
    --ink:var(--text);
    --bg:var(--bg-0);
    --accent:var(--lime);
    --ink-dark:#0c0c10;
    --line:#252536;
  }
  *{box-sizing:border-box}
  html, body{
    background: linear-gradient(180deg, var(--bg-0), var(--bg-1) 60%, var(--bg-2));
    color: var(--text);
  }
  body{margin:0;font:16px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial;position:relative}
  
  /* MEGA BACKGROUND WORDMARK */
  .bg-wordmark{
    position:fixed; inset:0; display:flex; flex-direction:column; justify-content:space-between;
    pointer-events:none; z-index:0; overflow:hidden; padding:5vh 0;
  }
  .bg-wordmark span{
    font-weight:900; white-space:nowrap;
    font-size:14vh;
    letter-spacing:-0.8vw;
    color:#ffe0f0;
    opacity:.32;
    text-shadow:0 18px 90px rgba(255,224,240,.6);
    user-select:none;
  }
  .bg-top{
    align-self:flex-start;
    transform:translateX(-8vw) rotate(-4deg) scaleX(0.7) scaleY(2.5);
  }
  .bg-bottom{
    align-self:flex-end;
    transform:translateX(8vw) rotate(3deg) scaleX(0.7) scaleY(2.5);
  }
  
  .wrap{height:100dvh;display:grid;grid-template-rows:auto 1fr auto;position:relative;z-index:1}
  header{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--line);background:rgba(255,255,255,.02);backdrop-filter:saturate(120%) blur(6px)}
  header a{color:var(--accent);text-decoration:none;font-weight:900}
  header .title{font-weight:900;letter-spacing:.01em}
  .chips{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  .chip{border:1px solid var(--line);color:var(--muted);background:rgba(255,255,255,.02);padding:6px 10px;border-radius:999px;font-size:13px;white-space:nowrap}
  .chip.switch{cursor:pointer}
  #log{padding:18px;overflow:auto;scroll-behavior:smooth}
  .msg{max-width:860px;margin:0 auto 12px auto;display:flex;gap:10px}
  .you .bubble{margin-left:auto;background:#152;border:1px solid var(--line)}
  .ai .bubble{background:#1a1a1a;border:1px solid var(--line)}
  .avatar, .pfp{width:28px;height:28px;border-radius:50%;background:#2a2a2a;flex:0 0 auto;display:grid;place-items:center;font-weight:700;color:var(--muted)}
  .bubble{border-radius:14px;padding:10px 14px;box-shadow:0 10px 28px rgba(0,0,0,.35)}
  .trans{color:var(--muted);font-size:13px;margin-top:6px}
  .typing{display:inline-block;min-width:12px;border-right:2px solid var(--ink);animation:blink 1s steps(1,end) infinite}
  @keyframes blink{50%{border-color:transparent}}
  footer{border-top:1px solid var(--line);padding:10px;background:rgba(255,255,255,.02)}
  form{max-width:960px;margin:0 auto;display:grid;grid-template-columns:1fr auto;gap:10px}
  textarea{width:100%;min-height:54px;max-height:36dvh;resize:vertical;background:#0f1016;color:var(--ink);border:1px solid var(--line);border-radius:12px;padding:12px;font:15px/1.5 ui-sans-serif,system-ui}
  button{appearance:none;border:0;cursor:pointer;padding:12px 18px;border-radius:12px;font-weight:900;color:var(--ink-dark);background:linear-gradient(90deg,var(--accent),var(--cyan))}
  .row{max-width:960px;margin:8px auto 0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between}
  .left{display:flex;gap:10px;align-items:center}
  .hint{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<!-- big background wordmark -->
<div class="bg-wordmark">
  <span class="bg-top">TY VOLE</span>
  <span class="bg-bottom">.WTF</span>
</div>

<div class="wrap">
  <header>
    <a href="/">&larr; zpƒõt</a>
    <div class="title">Tyk√°ƒç ‚Äì chat</div>
    <div class="chips">
      <label class="chip switch" title="Zobraz√≠ p≈ôeklad pod odpovƒõd√≠">
        <input id="chkTrans" type="checkbox" style="vertical-align:-2px;margin-right:6px">Dej p≈ôeklad
      </label>
      <div id="modeChip" class="chip switch" title="P≈ôepnout vibe">Vibe: Edgy</div>
    </div>
  </header>

  <main id="log" aria-live="polite"></main>

  <footer>
    <form id="f">
      <textarea id="q" placeholder="Hoƒè sem t√©ma‚Ä¶ t≈ôeba '≈°kola je pain, co s t√≠m' üò≠" aria-label="Napi≈° zpr√°vu Tyk√°ƒçovi"></textarea>
      <button id="send" type="submit" aria-label="Odeslat zpr√°vu">Po≈°li</button>
    </form>
    <div class="row">
      <div class="left">
        <span class="chip">#skibidi</span><span class="chip">#rizz</span><span class="chip">#based</span><span class="chip">#drip</span>
      </div>
      <div class="hint">Tip: p≈ôepni ‚ÄûVibe‚Äú pro klidnƒõj≈°√≠ styl.</div>
    </div>
  </footer>
</div>

<script>
const elLog = document.getElementById('log');
const elForm = document.getElementById('f');
const elQ = document.getElementById('q');
const elTrans = document.getElementById('chkTrans');
const elMode = document.getElementById('modeChip');

let MODE = (localStorage.getItem('chatMode') || 'edgy'); // edgy by default
let SHOW_TRANSLATION = localStorage.getItem('chatTrans') === '1';

elTrans.checked = SHOW_TRANSLATION;
elTrans.onchange = () => {
  SHOW_TRANSLATION = elTrans.checked;
  localStorage.setItem('chatTrans', SHOW_TRANSLATION ? '1':'0');
};
const applyMode = () => elMode.textContent = 'Vibe: ' + (MODE === 'edgy' ? 'Edgy' : 'Safe');
applyMode();
elMode.onclick = () => {
  MODE = MODE === 'edgy' ? 'family_friendly' : 'edgy';
  localStorage.setItem('chatMode', MODE);
  applyMode();
};

function msg(role, html, translated=''){
  const row = document.createElement('div');
  row.className = 'msg ' + (role === 'user' ? 'you':'ai');

  const pfp = document.createElement('div');
  pfp.className = 'pfp';
  pfp.textContent = role === 'user' ? 'U' : 'T';

  const b = document.createElement('div');
  b.className = 'bubble';
  b.innerHTML = html;

  if (translated){
    const t = document.createElement('div');
    t.className = 'trans';
    t.textContent = '‚Ü≥ P≈ôeklad: ' + translated;
    b.appendChild(t);
  }

  row.appendChild(pfp);
  row.appendChild(b);
  elLog.appendChild(row);
  elLog.scrollTop = elLog.scrollHeight;
  return b;
}

function typingBubble(){
  const el = msg('assistant', '<span class="typing"></span>');
  return {
    set(text){ el.innerHTML = text; },
    done(){ /* nothing */ }
  };
}

// prvn√≠ lehce drzej opener:
// First message with delay
setTimeout(() => {
  msg('assistant', "ƒåau, tak co ≈ôe≈°√≠≈°? Hoƒè to sem, ≈æ√°dn√Ω slohy ‚Äì jedeme short & spicy.");
}, 1000);

async function apiChat(q){
  const r = await fetch('/.netlify/functions/chat?mode='+encodeURIComponent(MODE), {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ q })
  });
  if(!r.ok) throw new Error('HTTP '+r.status);
  return r.json();
}

async function apiTranslate(text){
  const r = await fetch('/.netlify/functions/translate', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ text, direction:'gz_to_normal' })
  });
  if(!r.ok) return '';
  const j = await r.json();
  return j.translated || '';
}

elForm.onsubmit = async (e) => {
  e.preventDefault();
  const q = elQ.value.trim();
  if(!q) return;
  elQ.value = '';

  msg('user', q);

  const live = typingBubble();
  try{
    const data = await apiChat(q);
    let reply = (data.reply || '').trim();
    if(!reply) reply = "Mid ot√°zka, zkus konkr√©tnƒõji.";
    let translated = '';
    if(SHOW_TRANSLATION){
      translated = await apiTranslate(reply);
    }
    live.set(reply + (translated ? `<div class="trans">‚Ü≥ P≈ôeklad: ${translated}</div>` : ''));
    live.done();
  }catch(e){
    live.set("Rip, spadla s√≠≈•. Dej je≈°tƒõ jednou.");
  }
};
</script>
</body>
</html>
