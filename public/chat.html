<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tykáč – chat</title>
<meta name="description" content="Gen-Z chat (Tykáč). Krátké, trefné, trochu drzé odpovědi.">
<style>
  :root{
    --bg:#0b0b11; --ink:#f3f3f8; --muted:#a7a7b6; --line:#252536;
    --card:#11121a; --accent:#9DFF00; --cyan:#00F0FF; --ink-dark:#0c0c10;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial}
  .wrap{height:100dvh;display:grid;grid-template-rows:auto 1fr auto}
  header{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--line);background:rgba(255,255,255,.02);backdrop-filter:saturate(120%) blur(6px)}
  header a{color:var(--accent);text-decoration:none;font-weight:900}
  header .title{font-weight:900;letter-spacing:.01em}
  .chips{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  .chip{border:1px solid var(--line);color:var(--muted);background:rgba(255,255,255,.02);padding:6px 10px;border-radius:999px;font-size:13px;white-space:nowrap}
  .chip.switch{cursor:pointer}
  #log{padding:18px;overflow:auto;scroll-behavior:smooth}
  .msg{max-width:860px;margin:0 auto 12px auto;display:flex;gap:10px}
  .you .bubble{margin-left:auto;background:#1a1b25;border:1px solid var(--line)}
  .ai .bubble{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));border:1px solid var(--line)}
  .pfp{width:34px;height:34px;border-radius:50%;background:#15161f;border:1px solid var(--line);flex:0 0 auto;display:grid;place-items:center;font-weight:900;color:var(--muted)}
  .bubble{border-radius:14px;padding:12px 14px;box-shadow:0 10px 28px rgba(0,0,0,.35)}
  .trans{color:var(--muted);font-size:13px;margin-top:6px}
  .typing{display:inline-block;min-width:12px;border-right:2px solid var(--ink);animation:blink 1s steps(1,end) infinite}
  @keyframes blink{50%{border-color:transparent}}
  footer{border-top:1px solid var(--line);padding:10px;background:rgba(255,255,255,.02)}
  form{max-width:960px;margin:0 auto;display:grid;grid-template-columns:1fr auto;gap:10px}
  textarea{width:100%;min-height:54px;max-height:36dvh;resize:vertical;background:#0f1016;color:var(--ink);border:1px solid var(--line);border-radius:12px;padding:12px;font:15px/1.5 ui-sans-serif,system-ui}
  button{appearance:none;border:0;cursor:pointer;padding:12px 18px;border-radius:12px;font-weight:900;color:var(--ink-dark);background:linear-gradient(90deg,var(--accent),var(--cyan))}
  .row{max-width:960px;margin:8px auto 0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between}
  .left{display:flex;gap:10px;align-items:center}
  .hint{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <a href="/">&larr; zpět</a>
    <div class="title">Tykáč – chat</div>
    <div class="chips">
      <label class="chip switch" title="Zobrazí překlad pod odpovědí">
        <input id="chkTrans" type="checkbox" style="vertical-align:-2px;margin-right:6px">Dej překlad
      </label>
      <div id="modeChip" class="chip switch" title="Přepnout vibe">Vibe: Edgy</div>
    </div>
  </header>

  <main id="log" aria-live="polite"></main>

  <footer>
    <form id="f">
      <textarea id="q" placeholder="Hoď sem téma… třeba 'škola je pain, co s tím'"></textarea>
      <button id="send" type="submit">Pošli</button>
    </form>
    <div class="row">
      <div class="left">
        <span class="chip">#skibidi</span><span class="chip">#rizz</span><span class="chip">#based</span><span class="chip">#drip</span>
      </div>
      <div class="hint">Tip: přepni „Vibe“ pro klidnější styl.</div>
    </div>
  </footer>
</div>

<script>
const elLog = document.getElementById('log');
const elForm = document.getElementById('f');
const elQ = document.getElementById('q');
const elTrans = document.getElementById('chkTrans');
const elMode = document.getElementById('modeChip');

let MODE = (localStorage.getItem('chatMode') || 'edgy'); // edgy by default
let SHOW_TRANSLATION = localStorage.getItem('chatTrans') === '1';

elTrans.checked = SHOW_TRANSLATION;
elTrans.onchange = () => {
  SHOW_TRANSLATION = elTrans.checked;
  localStorage.setItem('chatTrans', SHOW_TRANSLATION ? '1':'0');
};
const applyMode = () => elMode.textContent = 'Vibe: ' + (MODE === 'edgy' ? 'Edgy' : 'Safe');
applyMode();
elMode.onclick = () => {
  MODE = MODE === 'edgy' ? 'family_friendly' : 'edgy';
  localStorage.setItem('chatMode', MODE);
  applyMode();
};

function msg(role, html, translated=''){
  const row = document.createElement('div');
  row.className = 'msg ' + (role === 'user' ? 'you':'ai');

  const pfp = document.createElement('div');
  pfp.className = 'pfp';
  pfp.textContent = role === 'user' ? 'U' : 'T';

  const b = document.createElement('div');
  b.className = 'bubble';
  b.innerHTML = html;

  if (translated){
    const t = document.createElement('div');
    t.className = 'trans';
    t.textContent = '↳ Překlad: ' + translated;
    b.appendChild(t);
  }

  row.appendChild(pfp);
  row.appendChild(b);
  elLog.appendChild(row);
  elLog.scrollTop = elLog.scrollHeight;
  return b;
}

function typingBubble(){
  const el = msg('assistant', '<span class="typing"></span>');
  return {
    set(text){ el.innerHTML = text; },
    done(){ /* nothing */ }
  };
}

// první lehce drzej opener:
msg('assistant', "Čau, tak co řešíš? Hoď to sem, žádný slohy – jedeme short & spicy.");

async function apiChat(q){
  const r = await fetch('/.netlify/functions/chat?mode='+encodeURIComponent(MODE), {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ q })
  });
  if(!r.ok) throw new Error('HTTP '+r.status);
  return r.json();
}

async function apiTranslate(text){
  const r = await fetch('/.netlify/functions/translate', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ text, direction:'gz_to_normal' })
  });
  if(!r.ok) return '';
  const j = await r.json();
  return j.translated || '';
}

elForm.onsubmit = async (e) => {
  e.preventDefault();
  const q = elQ.value.trim();
  if(!q) return;
  elQ.value = '';

  msg('user', q);

  const live = typingBubble();
  try{
    const data = await apiChat(q);
    let reply = (data.reply || '').trim();
    if(!reply) reply = "Mid otázka, zkus konkrétněji.";
    let translated = '';
    if(SHOW_TRANSLATION){
      translated = await apiTranslate(reply);
    }
    live.set(reply + (translated ? `<div class="trans">↳ Překlad: ${translated}</div>` : ''));
    live.done();
  }catch(e){
    live.set("Rip, spadla síť. Dej ještě jednou.");
  }
};
</script>
</body>
</html>
