<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PWA Debug Cleaner</title>
<style>
body {
  font-family: system-ui;
  max-width: 600px;
  margin: 2rem auto;
  padding: 1rem;
  background: #0A0A0A;
  color: #fff;
}
button {
  background: #2dd4bf;
  color: #000;
  border: none;
  padding: 1rem 2rem;
  font-size: 1rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
button:hover {
  background: #34d9c4;
}
#output {
  margin-top: 2rem;
  padding: 1rem;
  background: #111;
  border-radius: 8px;
  font-family: monospace;
  font-size: 0.875rem;
}
.log {
  margin: 0.25rem 0;
}
.success { color: #2dd4bf; }
.error { color: #ff6b6b; }
</style>
</head>
<body>

<h1>üßπ PWA Debug Cleaner</h1>
<p>Toto sma≈æe v≈°echny SW, cache a localStorage PWA hodnoty. Po kliknut√≠ refreshni str√°nku.</p>

<button onclick="cleanAll()">VYƒåISTIT V≈†E</button>

<div id="output"></div>

<script>
const output = document.getElementById('output');

function log(msg, type = '') {
  const div = document.createElement('div');
  div.className = `log ${type}`;
  div.textContent = msg;
  output.appendChild(div);
}

async function cleanAll() {
  output.innerHTML = '';
  log('üßπ Zahajuji ƒçi≈°tƒõn√≠...');

  // 1. Unregister all service workers
  if ('serviceWorker' in navigator) {
    try {
      const registrations = await navigator.serviceWorker.getRegistrations();
      log(`üì¶ Nalezeno ${registrations.length} SW registrac√≠`);
      
      for (const reg of registrations) {
        await reg.unregister();
        log(`‚úÖ Odregistrov√°n SW: ${reg.scope}`, 'success');
      }
    } catch (err) {
      log(`‚ùå Chyba p≈ôi odregistraci SW: ${err.message}`, 'error');
    }
  } else {
    log('‚ö†Ô∏è Service Worker API nen√≠ k dispozici');
  }

  // 2. Delete all caches
  if ('caches' in window) {
    try {
      const cacheNames = await caches.keys();
      log(`üóÑÔ∏è Nalezeno ${cacheNames.length} cache √∫lo≈æi≈°≈•`);
      
      for (const name of cacheNames) {
        await caches.delete(name);
        log(`‚úÖ Smaz√°n cache: ${name}`, 'success');
      }
    } catch (err) {
      log(`‚ùå Chyba p≈ôi maz√°n√≠ cache: ${err.message}`, 'error');
    }
  } else {
    log('‚ö†Ô∏è Cache API nen√≠ k dispozici');
  }

  // 3. Clear PWA-related localStorage
  try {
    const pwaKeys = Object.keys(localStorage).filter(k => 
      k.includes('pwa') || k.includes('PWA') || k.includes('install')
    );
    log(`üîë Nalezeno ${pwaKeys.length} PWA localStorage kl√≠ƒç≈Ø`);
    
    pwaKeys.forEach(key => {
      localStorage.removeItem(key);
      log(`‚úÖ Smaz√°n localStorage: ${key}`, 'success');
    });
  } catch (err) {
    log(`‚ùå Chyba p≈ôi maz√°n√≠ localStorage: ${err.message}`, 'error');
  }

  // 4. Clear PWA-related sessionStorage
  try {
    const sessionKeys = Object.keys(sessionStorage).filter(k => 
      k.includes('pwa') || k.includes('PWA') || k.includes('install')
    );
    log(`üîë Nalezeno ${sessionKeys.length} PWA sessionStorage kl√≠ƒç≈Ø`);
    
    sessionKeys.forEach(key => {
      sessionStorage.removeItem(key);
      log(`‚úÖ Smaz√°n sessionStorage: ${key}`, 'success');
    });
  } catch (err) {
    log(`‚ùå Chyba p≈ôi maz√°n√≠ sessionStorage: ${err.message}`, 'error');
  }

  log('');
  log('‚úÖ HOTOVO. Nyn√≠ refreshni str√°nku (Ctrl+R nebo Cmd+R).', 'success');
  log('üí° Po refreshi otev≈ôi DevTools ‚Üí Application ‚Üí Manifest a zkontroluj zelen√© checkmarky.', 'success');
}
</script>

</body>
</html>
