<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TY VOLE .wtf ‚Äî vibe generator</title>
<meta name="description" content="Gen-Z hl√°≈°ky, chat a p≈ôekladaƒç Gen-Z ‚Üî norm√°ln√≠ ƒçe≈°tina.">

<!-- PWA + ikony -->
<link rel="manifest" href="/manifest.webmanifest?v=5">
<meta name="theme-color" content="#111111">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root{
    --bg:#0b0b11; --ink:#f3f3f8; --muted:#a7a7b6; --line:#252536;
    --card:#11121a; --accent:#9DFF00; --cyan:#00F0FF; --ink-dark:#0c0c10;
    --pink:#ff63b8;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    font:16px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial;
    background:
      radial-gradient(1200px 600px at 75% 5%, rgba(0,240,255,.06), transparent 60%),
      radial-gradient(900px 520px at 15% 90%, rgba(157,255,0,.05), transparent 55%),
      var(--bg);
    min-height:100dvh; display:grid; place-items:center; padding:28px;
    position:relative; overflow-x:hidden;
  }

  /* === MEGA BACKGROUND WORDMARK (cel√° obrazovka) === */
  .bg-wordmark{
    position:fixed; inset:0; display:flex; flex-direction:column; justify-content:space-between;
    pointer-events:none; z-index:0; overflow:hidden; padding:5vh 0;
  }
  .bg-wordmark span{
    font-weight:900; white-space:nowrap;
    font-size:18vh;
    letter-spacing:-0.8vw;
    color:#ffc0e0;                /* svƒõtlej≈°√≠ r≈Ø≈æov√° */
    opacity:.16;
    text-shadow:0 14px 70px rgba(255,192,224,.45);
    user-select:none;
  }
  .bg-top{
    align-self:flex-start;
    transform:translateX(-8vw) rotate(-4deg) scaleX(0.7) scaleY(2.5);
  }
  .bg-bottom{
    align-self:flex-end;
    transform:translateX(8vw) rotate(3deg) scaleX(0.7) scaleY(2.5);
  }

  .wrap{width:min(980px,100%); position:relative; z-index:1;}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  .brand{display:flex;gap:10px;align-items:center;font-weight:900;letter-spacing:.02em}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,var(--accent),var(--cyan));box-shadow:0 0 16px rgba(157,255,0,.7)}
  .brand span{opacity:.66}
  .chips{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chip{border:1px solid var(--line);color:var(--muted);background:rgba(255,255,255,.02);padding:8px 12px;border-radius:999px;font-size:13px}
  .chip.btn{cursor:pointer;color:var(--ink-dark);background:linear-gradient(90deg,var(--accent),var(--cyan));border:0;font-weight:900}

  .card{border:1px solid var(--line);border-radius:24px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));padding:26px;box-shadow:0 22px 60px rgba(0,0,0,.38)}
  h1{margin:0 0 6px;font-size:clamp(28px,7vw,56px);line-height:1.1;letter-spacing:-.02em}
  .subtitle{color:var(--muted);font-weight:600;font-size:14px}
  .quote{margin:18px 0 6px;font-weight:900;font-size:clamp(22px,4.5vw,40px);letter-spacing:-.015em; min-height:2.4em}
  .trans{color:var(--muted);font-size:15px;margin-top:2px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  button{appearance:none;border:0;cursor:pointer;font-weight:900;padding:12px 16px;border-radius:14px}
  .primary{color:var(--ink-dark);background:linear-gradient(90deg,var(--accent),var(--cyan))}
  .ghost{color:var(--ink);background:transparent;border:1px solid var(--line)}
  .tiny{font-size:13px;padding:8px 12px}

  footer{margin-top:12px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px}
  .mode{display:flex;gap:6px;align-items:center}
  .mode button{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:transparent;color:var(--muted);font-weight:700}
  .mode button.active{border-color:var(--accent);color:var(--ink)}

  .cta{
    position:fixed;right:18px;bottom:18px;
    width:min(340px,calc(100% - 36px));
    border:1px solid var(--line);border-radius:16px;
    padding:12px 14px;background:rgba(18,18,26,.92);
    backdrop-filter:saturate(140%) blur(6px);
    box-shadow:0 18px 50px rgba(0,0,0,.45);
    z-index:2;
  }
  .cta a{display:block;color:var(--accent);font-weight:900;text-decoration:none}
  .cta small{display:block;color:var(--muted);margin-top:6px}
  
  /* bottom sheet (translator) */
  .sheet-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none; z-index:10;}
  .sheet{position:fixed;left:0;right:0;bottom:0;max-height:70dvh;background:#11121a;border-top:1px solid var(--line);border-radius:18px 18px 0 0;transform:translateY(100%);transition:.2s ease-out; z-index:11;}
  .sheet.open{transform:translateY(0)}
  .sheet-backdrop.show{display:block}
  .sheet .head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--line)}
  .sheet .body{padding:14px 16px}
  .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  textarea{width:100%;min-height:120px;background:#0f1016;color:var(--ink);border:1px solid var(--line);border-radius:12px;padding:12px;font:15px/1.5 ui-sans-serif,system-ui}
  .smallrow{display:flex;gap:8px;margin-top:8px}
</style>
</head>
<body>
  <!-- big background wordmark -->
  <div class="bg-wordmark">
    <span class="bg-top">TY VOLE</span>
    <span class="bg-bottom">.WTF</span>
  </div>

  <div class="wrap">
    <header>
      <div class="brand"><div class="dot"></div><div>TY&nbsp;VOLE<span>.wtf</span></div></div>
      <div class="chips">
        <div class="chip">#skibidi</div><div class="chip">#rizz</div><div class="chip">#based</div><div class="chip">#drip</div>
        <button id="btnSheet" class="chip btn">Skibidi p≈ôekladaƒç</button>
      </div>
    </header>

    <div class="card">
      <div class="subtitle">Instant vibe generator</div>
      <div class="quote" id="quote">‚Ä¶naƒç√≠t√°m fresh hl√°≈°ku‚Ä¶</div>
      <div class="trans" id="quoteTranslated" style="display:none;"></div>

      <div class="row">
        <button id="next" class="primary">Dal≈°√≠ shot üî•</button>
        <button id="copy" class="ghost" title="Zkop√≠ruje URL s touhle hl√°≈°kou">Zkopƒçi link</button>
        <button id="share" class="ghost tiny" title="Sd√≠lej do zpr√°v nebo appky">Po≈°li d√°l</button>
        <label class="chip" style="cursor:pointer;">
          <input id="chkAutoTrans" type="checkbox" style="vertical-align:middle;margin-right:6px;"> Dej p≈ôeklad
        </label>
      </div>

      <footer>
        <div class="mode">
          <span>Mood:</span>
          <button data-mode="genz" id="btnGenz" class="active">Gen-Z</button>
          <button data-mode="family_friendly" id="btnSafe">Safe</button>
        </div>
      </footer>
    </div>
  </div>

  <div class="cta">
    <a href="/chat.html">M√°m i chat, no cap ‚Üí</a>
  </div>

  <!-- Translator bottom sheet -->
  <div class="sheet-backdrop" id="backdrop"></div>
  <section class="sheet" id="sheet">
    <div class="head">
      <strong>P≈ôekladaƒç Gen-Z ‚Üî norm√°ln√≠</strong>
      <div>
        <button id="closeSheet" class="ghost tiny">Zav≈ô√≠t</button>
      </div>
    </div>
    <div class="body">
      <div class="cols">
        <div>
          <div class="subtitle">Norm√°ln√≠ ‚Üí Gen-Z</div>
          <textarea id="tNorm" placeholder="Napi≈° norm√°lnƒõ‚Ä¶"></textarea>
          <div class="smallrow">
            <button id="bNorm2Genz" class="primary">P≈ôelo≈æit</button>
          </div>
        </div>
        <div>
          <div class="subtitle">Gen-Z ‚Üí Norm√°ln√≠</div>
          <textarea id="tGenz" placeholder="Nebo Gen-Z‚Ä¶"></textarea>
          <div class="smallrow">
            <button id="bGenz2Norm" class="primary">P≈ôelo≈æit</button>
          </div>
        </div>
      </div>
    </div>
  </section>

<script>
let MODE = (localStorage.getItem('mode') || 'genz');
let AUTO = localStorage.getItem('autoTrans') === '1';
const LAST = [];

// ===== Lexikon =====
const L = { openers:[], tones_pos:[], tones_mid:[], tones_neg:[], verbs:[], nouns:[], actions:[], emotes:[], templates:[], quotes:[] };

const pick = arr => arr[Math.floor(Math.random()*arr.length)];
const uniquePick = (arr) => { let tries=0; while(tries<10){ const v=pick(arr); if(!LAST.includes(v)) return v; tries++; } return pick(arr); };

async function loadLexicon(){
  try{
    const lex = await fetch('/config/lexicon.json?v=20251102').then(r=>{
      if(!r.ok) throw new Error('lexicon fetch '+r.status);
      return r.json();
    });
    Object.assign(L, lex);
  }catch(e){
    Object.assign(L, { openers:["Hele"], templates:["No cap, dal≈°√≠."], quotes:["No cap, dal≈°√≠."] });
  }
}

function compose(){
  if (Math.random() < 0.8 && L.templates.length){
    const tpl = uniquePick(L.templates);
    return tpl
      .replace("{opener}", uniquePick(L.openers))
      .replace("{tones_pos}", uniquePick(L.tones_pos))
      .replace("{tones_mid}", uniquePick(L.tones_mid))
      .replace("{tones_neg}", uniquePick(L.tones_neg))
      .replace("{verbs}", uniquePick(L.verbs))
      .replace("{nouns}", uniquePick(L.nouns))
      .replace("{actions}", uniquePick(L.actions))
      .replace("{emote}", uniquePick(L.emotes));
  }
  return uniquePick(L.quotes.length ? L.quotes : ["No cap, dal≈°√≠."]);
}

function setUrlState(text, push=true){
  if (LAST.push(text)>10) LAST.shift();
  const url=new URL(location.href);
  url.searchParams.set('q', encodeURIComponent(text));
  url.searchParams.set('mode', MODE);
  history[push?'pushState':'replaceState'](null,'',url);
}

async function typeOut(el, text, speed=18){
  el.textContent = '';
  for (let i=0;i<text.length;i++){
    el.textContent += text[i];
    await new Promise(r=>setTimeout(r, speed));
  }
}

async function setQuoteTyped(text, push=true){
  const el = document.getElementById('quote');
  await typeOut(el, text);
  setUrlState(text, push);
  if(AUTO) showAutoTranslation(text);
}

/* ========= Lok√°ln√≠ p≈ôekladaƒç CZ <-> Gen-Z (regex-based) ========= */
const CZ2GZ_PHRASES = [
  [/(c√≠t√≠m|citim)\s+se\s+(hodnƒõ|hodne)\s+trapn(ƒõ|e)/gi, 'c√≠t√≠m se mega cringe'],
  [/(c√≠t√≠m|citim)\s+se\s+trapn(ƒõ|e)/gi, 'c√≠t√≠m se cringe'],
  [/bez\s+(srandy|kec≈Ø|kecu)/gi, 'no cap'],
  [/to\s+je\s+(pravda|real)/gi, 'no cap'],
  [/to\s+je\s+le≈æ/gi, 'cap']
];

const CZ2GZ_WORDS = [
  [/moment/gi, 'moment'],
  [/kr(√°|a)tk(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|ej|y|i)/gi, 'kr√°tkej'],
  [/revive[\-\s]?nout/gi, 'revive-nout'],
  [/trapn(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|y|i)/gi, 'cringe'],
  [/divn(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|y|i)/gi, 'skibidi'],
  [/hodn(ƒõ|e)/gi, 'mega'],
  [/dost/gi, 'lowkey'],
  [/opravdu/gi, 'fr'],
  [/v(√°|a)≈æn(ƒõ|e)/gi, 'fr'],
  [/up≈ô(√≠|i)mn(ƒõ|e)/gi, 'ngl'],
  [/charism(a|y|u|ou|e|ƒõ)/gi, 'rizz'],
  [/drb(y|≈Ø|√°m|ami|a)/gi, 'tea'],
  [/toxick(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|y|i)/gi, 'toxic'],
  [/autentick(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|y|i)/gi, 'based'],
  [/dobr(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|y|i)/gi, 'valid'],
  [/(v√Ω|vy)born(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|y|i)/gi, 'bussin'],
  [/super/gi, 'fire'],
  [/nƒõco\s+dobr(√Ω|√©|√©ho)/gi, 'something valid']
];

const GZ2CZ_WORDS = [
  [/no\s+cap/gi, 'fakt, bez kec≈Ø'],
  [/skill\s+issue/gi, 'probl√©m se schopnostmi'],
  [/revive[\-\s]?nout/gi, 'o≈æivit'],
  [/kr(√°|a)tk(√Ω|√©ho|√©mu|√Ωm|√©m|√°|ou|√©|e|ej|y|i)/gi, 'kr√°tk√Ω'],
  [/skibidi/gi, 'divn√©'],
  [/bussin['"]?/gi, 'v√Ωborn√©'],
  [/rizz/gi, 'charisma'],
  [/based/gi, 'autentick√©'],
  [/slay/gi, 'perfektn√≠'],
  [/cringe/gi, 'trapn√©'],
  [/vibe(s)?/gi, 'n√°lada'],
  [/toxic/gi, 'toxick√©'],
  [/\btea\b/gi, 'drby'],
  [/delulu/gi, 'mimo realitu'],
  [/\bfr\b/gi, 'v√°≈ænƒõ'],
  [/\bngl\b/gi, 'up≈ô√≠mnƒõ'],
  [/\bidk\b/gi, 'nev√≠m'],
  [/\bimo\b/gi, 'podle mƒõ'],
  [/lowkey/gi, 'trochu'],
  [/highkey/gi, 'hodnƒõ'],
  [/\bmid\b/gi, 'pr≈Ømƒõrn√©'],
  [/goated/gi, 'legend√°rn√≠'],
  [/kino/gi, 'filmov√©'],
  [/heat/gi, '≈æhav√©'],
  [/valid/gi, 'dobr√©'],
  [/drip/gi, 'styl'],
  [/mega/gi, 'hodnƒõ'],
  [/fire/gi, 'super'],
  [/\bcap\b/gi, 'le≈æ']
];

function looksGenZ(s){
  return /\b(skibidi|rizz|based|cringe|bussin|cap|no cap|slay|fr|ngl|mid|drip|goated|delulu|lowkey|highkey)\b/i.test(s);
}

function applyReplacements(s, pairs){
  let out = s;
  // Aplikuj v≈°echny nahrazen√≠ postupnƒõ
  for (const [re, to] of pairs){
    const regex = new RegExp(re.source, re.flags);
    let matches = [];
    let match;
    
    // Najdi v≈°echny matches
    while ((match = regex.exec(out)) !== null) {
      matches.push({index: match.index, length: match[0].length, original: match[0], replacement: to});
      // Pokud nen√≠ global flag, ukonƒçi
      if (!regex.global) break;
    }
    
    // Aplikuj v≈°echny nahrazen√≠ od konce, aby se neposunuly indexy
    for (let i = matches.length - 1; i >= 0; i--) {
      const m = matches[i];
      let replacement = m.replacement;
      // zachov√°n√≠ prvn√≠ kapitalizace
      if (m.original[0] === m.original[0].toUpperCase() && replacement.length) {
        replacement = replacement[0].toUpperCase() + replacement.slice(1);
      }
      out = out.substring(0, m.index) + replacement + out.substring(m.index + m.length);
    }
  }
  return out;
}

function translateLocal(text, direction){
  let s = String(text||'');
  if (!s.trim()) return "";
  if (direction === 'normal_to_gz'){
    s = applyReplacements(s, CZ2GZ_PHRASES);
    s = applyReplacements(s, CZ2GZ_WORDS);
    return s;
  }
  if (direction === 'gz_to_normal'){
    s = applyReplacements(s, GZ2CZ_WORDS);
    return s;
  }
  // autodetekce
  return looksGenZ(s) ? translateLocal(s,'gz_to_normal') : translateLocal(s,'normal_to_gz');
}

// p≈ôepis p≈Øvodn√≠ translate(): nejd≈ô√≠v lok√°ln√≠, serverless fallback ti≈°e
async function translate(text, direction){
  const local = translateLocal(text, direction);
  // kdy≈æ se nƒõco zmƒõnilo, vra≈• hned
  if (local && local.toLowerCase() !== String(text||'').toLowerCase()) return local;

  try{
    const r = await fetch('/.netlify/functions/translate',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ text, direction })
    });
    if (r.ok){
      const j = await r.json();
      if (j && j.translated) return j.translated;
    }
  }catch(e){}
  return local || String(text||'');
}
/* ========= konec lok√°ln√≠ho p≈ôekladaƒçe ========= */

async function showAutoTranslation(source){
  const el = document.getElementById('quoteTranslated');
  if(!AUTO){ el.style.display='none'; el.textContent=''; return; }
  const dir = looksGenZ(source) ? 'gz_to_normal' : 'normal_to_gz';
  const out = await translate(source, dir);
  if(out && out.trim() && out.trim().toLowerCase() !== source.trim().toLowerCase()){
    el.textContent = '‚Ü≥ P≈ôeklad: ' + out;
    el.style.display='block';
  } else {
    el.style.display='none';
    el.textContent='';
  }
}

async function init(){
  await loadLexicon();

  const btnG=document.getElementById('btnGenz');
  const btnS=document.getElementById('btnSafe');
  const apply=()=>{ btnG.classList.toggle('active',MODE==='genz'); btnS.classList.toggle('active',MODE==='family_friendly'); };
  btnG.onclick=()=>{ MODE='genz'; localStorage.setItem('mode',MODE); apply(); };
  btnS.onclick=()=>{ MODE='family_friendly'; localStorage.setItem('mode',MODE); apply(); };
  apply();

  const chk=document.getElementById('chkAutoTrans');
  chk.checked = AUTO;
  chk.onchange = ()=>{
    AUTO = chk.checked;
    localStorage.setItem('autoTrans', AUTO?'1':'0');
    if(!AUTO){ document.getElementById('quoteTranslated').style.display='none'; }
    else { showAutoTranslation(document.getElementById('quote').textContent); }
  };

  const url = new URLSearchParams(location.search);
  const q=url.get('q'); const m=url.get('mode'); if(m){ MODE=m; localStorage.setItem('mode',MODE); apply(); }
  const first = q?decodeURIComponent(q):compose();
  await setQuoteTyped(first, false);

  document.getElementById('next').onclick=async()=>{
    const text = compose();
    await setQuoteTyped(text);
  };
  document.getElementById('copy').onclick=async()=>{
    await navigator.clipboard.writeText(location.href);
    const c=document.getElementById('copy'); c.textContent='Zkopƒçeno ‚úÖ'; setTimeout(()=>c.textContent='Zkopƒçi link',1100);
  };
  document.getElementById('share').onclick=async()=>{
    try{
      if(navigator.share){
        await navigator.share({title:'TY VOLE .wtf',text:document.getElementById('quote').textContent,url:location.href});
      } else {
        await navigator.clipboard.writeText(location.href);
      }
      const s=document.getElementById('share');
      s.textContent='Odesl√°no ‚úÖ'; setTimeout(()=>s.textContent='Po≈°li d√°l',1100);
    }catch{}
  };

  // Translator bottom sheet
  const sheet=document.getElementById('sheet'), back=document.getElementById('backdrop');
  const openSheet=()=>{sheet.classList.add('open');back.classList.add('show');};
  const closeSheet=()=>{sheet.classList.remove('open');back.classList.remove('show');};
  document.getElementById('btnSheet').onclick=openSheet;
  document.getElementById('closeSheet').onclick=closeSheet; back.onclick=closeSheet;

  const tNorm=document.getElementById('tNorm'), tGenz=document.getElementById('tGenz');
  document.getElementById('bNorm2Genz').onclick=async()=>{ tGenz.value = await translate(tNorm.value,'normal_to_gz'); };
  document.getElementById('bGenz2Norm').onclick=async()=>{ tNorm.value = await translate(tGenz.value,'gz_to_normal'); };
}
init();

// PWA SW registrace
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').catch(console.error);
  });
}
</script>
</body>
</html>
